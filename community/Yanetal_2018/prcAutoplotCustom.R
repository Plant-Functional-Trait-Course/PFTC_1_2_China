library("cowplot")
autoplot.prcCustom <- function(object, select, xlab, ylab,
         title = NULL, subtitle = NULL, caption = NULL,
         legend.position = "top", ...) {
  ## fortify the model object
  fobj <- fortify(object)
  
  ## levels of factors - do this now before we convert things
  TimeLevs <- levels(fobj$Time)
  TreatLevs <- levels(fobj$Treatment)
  
  ## convert Time to a numeric
  fobj$Time <- as.numeric(as.character(fobj$Time))
  
  ## process select
  ind <- fobj$Score != "Sample"
  if(missing(select)) {
    select <- rep(TRUE,sum(ind))
  } else {
    stopifnot(isTRUE(all.equal(length(select), sum(ind))))
  }
  
  ## samples and species "scores"
  samp <- fobj[!ind, ]
  spp <- fobj[ind,][select, ]
  
  ## base plot
  plt <- ggplot(data = samp,
                aes_string(x = 'Time', y = 'Response', group = 'Treatment',
                           colour = 'Treatment', linetype = 'Treatment'))
  
  ## add the control
  plt <- plt + geom_hline(yintercept = 0)
  ## add species rug
  plt <- plt +
    geom_rug(data = spp,
             sides = "r",
             mapping = aes_string(group = NULL, x = NULL,
                                  colour = NULL, linetype = NULL))
  ## add the coefficients
  plt <- plt + geom_line(size = 1.5) +
    theme(legend.position = legend.position,
          text = element_text(size=20),
          axis.text = element_text(size = 20)) +
    scale_x_continuous(breaks = as.numeric(TimeLevs), minor_breaks = NULL)
  
  ## add labels
  if(missing(xlab)) {
    xlab <- 'Time'
  }
  if(missing(ylab)) {
    ylab <- 'Treatment'
  }
  plt <- plt + labs(x = xlab, y = ylab, title = title, subtitle = subtitle,
                    caption = caption) #+
    #theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),panel.background = element_blank(), axis.line = element_line(colour = "black"))
  
  ## return
  plt
}
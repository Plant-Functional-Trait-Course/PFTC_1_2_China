---
title: "Subturf Maps"
author: "Richard J. Telford"
date: "`r format(Sys.time(), '%d %B %Y')`"
output: pdf_document
classoption: a4paper
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE)
```


```{r importChunk, echo = FALSE}
#load packages
library("tidyr")
library("plyr")
library("DBI")# also needs RMySQL installed
library("dplyr")
library("ggplot2")

#source functions
source("R/load_subturfcomm.R")
source("R/load_comm.R")

#make database connection
con <- dbConnect(RMySQL::MySQL(), group = "transplant")

#load cover data and metadata
subturf_thin <- load_subturfcomm(con = con)
#  spread(subturf.thin, key = "subTurf", value = "adult", fill = 0)
cover_thin <-load_comm(con = con)
```

#Subturf maps

```{r, fig.height=11, fig.width = 7}
plyr::d_ply(subturf_thin, .(turfID), function(df){
  print(
  ggplot(df, aes(x = subTurf %/% 5, y = subTurf %% 5)) +
    geom_tile() +
    facet_grid(species ~ year) +
    ggtitle(paste(df$turfID[1], "subturf map")) +
    scale_x_continuous(expand = c(0, 0)) +
    scale_y_continuous(expand = c(0, 0)) +
    theme(
      axis.text = element_blank(), 
      axis.title = element_blank(), 
      axis.ticks = element_blank(),
      strip.text.y = element_text(angle = 0)
      )
  
  )
    cat("\n")
})
```